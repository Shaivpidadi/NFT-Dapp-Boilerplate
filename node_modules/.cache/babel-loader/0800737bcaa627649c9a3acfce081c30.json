{"ast":null,"code":"var queryString = require('query-string');\n\nvar setQuery = require('url-set-query');\n\nvar assign = require('object-assign');\n\nvar ensureHeader = require('./lib/ensure-header.js'); // this is replaced in the browser\n\n\nvar request = require('./lib/request.js');\n\nvar mimeTypeJson = 'application/json';\n\nvar noop = function () {};\n\nmodule.exports = xhrRequest;\n\nfunction xhrRequest(url, opt, cb) {\n  if (!url || typeof url !== 'string') {\n    throw new TypeError('must specify a URL');\n  }\n\n  if (typeof opt === 'function') {\n    cb = opt;\n    opt = {};\n  }\n\n  if (cb && typeof cb !== 'function') {\n    throw new TypeError('expected cb to be undefined or a function');\n  }\n\n  cb = cb || noop;\n  opt = opt || {};\n  var defaultResponse = opt.json ? 'json' : 'text';\n  opt = assign({\n    responseType: defaultResponse\n  }, opt);\n  var headers = opt.headers || {};\n  var method = (opt.method || 'GET').toUpperCase();\n  var query = opt.query;\n\n  if (query) {\n    if (typeof query !== 'string') {\n      query = queryString.stringify(query);\n    }\n\n    url = setQuery(url, query);\n  } // allow json response\n\n\n  if (opt.responseType === 'json') {\n    ensureHeader(headers, 'Accept', mimeTypeJson);\n  } // if body content is json\n\n\n  if (opt.json && method !== 'GET' && method !== 'HEAD') {\n    ensureHeader(headers, 'Content-Type', mimeTypeJson);\n    opt.body = JSON.stringify(opt.body);\n  }\n\n  opt.method = method;\n  opt.url = url;\n  opt.headers = headers;\n  delete opt.query;\n  delete opt.json;\n  return request(opt, cb);\n}","map":null,"metadata":{},"sourceType":"script"}